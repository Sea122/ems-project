{% extends "layout.html" %}
{% block header_title %}HR Database{% endblock %}
{% block content %}
<div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden min-h-[600px]">
    <div class="px-6 py-4 border-b bg-gray-50 flex justify-between items-center">
        <div class="relative w-72">
            <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400">
                <i class="fas fa-search"></i>
            </span>
            <input type="text" id="searchInput" onkeyup="filterTable()" placeholder="Search employee..." class="w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm">
        </div>
        {% if user.role == 'Head of Department' %}
        <button onclick="toggleModal('addEmpModal')" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 shadow-sm flex items-center text-sm font-bold">
            <i class="fas fa-user-plus mr-2"></i> Add New Employee
        </button>
        {% endif %}
    </div>
    <div class="overflow-x-auto">
        <table class="w-full text-left" id="empTable">
            <thead class="bg-gray-100 text-gray-500 text-xs uppercase">
                <tr>
                    <th class="px-6 py-3">Profile</th>
                    <th class="px-6 py-3">Role</th>
                    <th class="px-6 py-3">Department</th>
                    <th class="px-6 py-3 text-right">Actions</th>
                </tr>
            </thead>
            <tbody class="divide-y text-sm">
                {% for emp in employees %}
                <tr class="hover:bg-gray-50 group transition">
                    <td class="px-6 py-4 flex items-center">
                         <img src="{{ emp.avatar }}" class="h-10 w-10 rounded-full mr-4 border-2 border-white shadow-sm">
                         <div>
                             <div class="font-bold text-gray-800">{{ emp.name }}</div>
                             <div class="text-xs text-gray-400 font-mono">{{ emp.id }}</div>
                         </div>
                    </td>
                    <td class="px-6 py-4 text-gray-600">{{ emp.role }}</td>
                    <td class="px-6 py-4">
                        <span class="px-2 py-1 bg-gray-100 text-gray-600 rounded text-xs border">{{ emp.dept }}</span>
                    </td>
                    <td class="px-6 py-4 text-right space-x-2">
                        {% if user.role == 'Head of Department' %}
                            <button onclick="openEditEmpModal('{{ emp.id }}', '{{ emp.name }}', '{{ emp.role }}', '{{ emp.dept }}')" class="text-blue-500 hover:text-blue-700 p-2 bg-blue-50 rounded-full">
                                <i class="fas fa-pen"></i>
                            </button>
                            {% if emp.id != user.id %}
                            <a href="/delete_employee/{{ emp.id }}" onclick="return confirm('Remove access for this user?');" class="text-red-500 hover:text-red-700 p-2 bg-red-50 rounded-full">
                                <i class="fas fa-trash"></i>
                            </a>
                            {% endif %}
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
<div id="addEmpModal" class="hidden fixed inset-0 z-50 overflow-y-auto bg-gray-900 bg-opacity-75 flex items-center justify-center p-4">
    <div class="bg-white rounded-lg w-full max-w-md p-6">
        <h3 class="text-lg font-bold mb-4">Add New Staff</h3>
        <form action="/add_employee" method="POST" class="space-y-3">
            <input type="text" name="id_card" placeholder="ID Card" required class="w-full border p-2 rounded">
            <input type="text" name="name" placeholder="Full Name" required class="w-full border p-2 rounded">
            <input type="text" name="role" placeholder="Position" required class="w-full border p-2 rounded">
            <input type="text" name="dept" placeholder="Department" required class="w-full border p-2 rounded">
            <input type="text" name="temp_pass" placeholder="Temp Password" required class="w-full border p-2 rounded bg-yellow-50">
            <div class="flex justify-end space-x-2 mt-4">
                <button type="button" onclick="toggleModal('addEmpModal')" class="bg-gray-300 px-4 py-2 rounded">Cancel</button>
                <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded">Save</button>
            </div>
        </form>
    </div>
</div>
<div id="editEmpModal" class="hidden fixed inset-0 z-50 overflow-y-auto bg-gray-900 bg-opacity-75 flex items-center justify-center p-4">
    <div class="bg-white rounded-lg w-full max-w-md p-6 border-t-4 border-blue-500">
        <h3 class="text-lg font-bold mb-4">Edit Employee Info</h3>
        <form action="/edit_employee" method="POST" class="space-y-3">
            <input type="hidden" id="edit_emp_id" name="emp_id">
            <input type="text" id="edit_emp_name" name="name" required class="w-full border p-2 rounded">
            <input type="text" id="edit_emp_role" name="role" required class="w-full border p-2 rounded">
            <input type="text" id="edit_emp_dept" name="dept" required class="w-full border p-2 rounded">
            <div class="flex justify-end space-x-2 mt-4">
                <button type="button" onclick="toggleModal('editEmpModal')" class="bg-gray-300 px-4 py-2 rounded">Cancel</button>
                <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Update</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
{% block scripts %}
<script>
    function openEditEmpModal(id, name, role, dept) {
        document.getElementById('edit_emp_id').value = id;
        document.getElementById('edit_emp_name').value = name;
        document.getElementById('edit_emp_role').value = role;
        document.getElementById('edit_emp_dept').value = dept;
        toggleModal('editEmpModal');
    }
    function filterTable() {
        var input, filter, table, tr, td, i, txtValue;
        input = document.getElementById("searchInput");
        filter = input.value.toUpperCase();
        table = document.getElementById("empTable");
        tr = table.getElementsByTagName("tr");
        for (i = 0; i < tr.length; i++) {
            td = tr[i].getElementsByTagName("td")[0];
            if (td) {
                txtValue = td.textContent || td.innerText;
                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    tr[i].style.display = "";
                } else {
                    tr[i].style.display = "none";
                }
            }       
        }
    }
</script>
{% endblock %}